#ifndef AAUTIL_H
#define AAUTIL_H
#include <stdbool.h>
#include <stdint.h>
#include <string.h>
// Agitated Alice's funky utility/silly c stunts/hacks shl V 0.2.1 :D
// Functions for testing bits, for isolating nibbles in bytes and an 8x8 font (WIP, to be completed and tweaked)

// macros to reduce function call overhead, simple, nifty, quick, easy, nice and all good for an agitated alice AABT tests the b'th bit of x UN and LN isolate upper and lower nibbles of a byte
#define AABT(x, b) ((x & (1 << b))!=0)
#define AAUN(v) ((v&0xF0)>>4)
#define AALN(v) (v&0x0F)
#define AAUB(v) ((v&0xFF00)>>8)
#define AALB(v) (v&0x00FF)

bool bitTest(unsigned char value, unsigned char bit){
    return (value & (1 << bit)) != 0;
}

// return upper or lower nibble, upper nibble is shifted into lower nibbles place when returned i.e un of 2E is 02 rather than 20 :)
unsigned char aanip(unsigned char in, bool sel){
	return (sel>0) ? ((in & 0xF0)>>4) : (in & 0x0F);
}

// unsigned 8 bit integer 2vectors, why might you need them? Stay tuned for even sillier tricks in C!
typedef struct {
	uint8_t x;
	uint8_t y;
} ui8vec;

// signed 8 bit integer 2vectors, the usage of this is a literal mystery!!!!! (wow :O)
typedef struct {
	int8_t x;
	int8_t y;
} i8vec;

typedef struct {
	uint16_t	mem[0x100]; // 0x00-0xFF
	uint8_t		p; // pointer
} stk816;

#define S816_PSH(s, v) if(s.p < 0xFF){s.mem[s.p] = v; s.p++;}else{s.mem[s.p] = v;}
#define S816_POP(s, v) if(s.p > 0x00){s.p--; v = s.mem[s.p]; s.mem[s.p] = 0; }else{v = s.mem[s.p] = v;}

stk816 S816_Init() {
	stk816 ret; ret.p = 0; memset(ret.mem, 0, 0x100); //for(uint16_t i = 0; i <= 0xFF; i++) ret.mem[i]=0x0000; ret.p = 0;
	return ret;
}

void S816_DUMP(stk816 *s){
	printf("Dumping stack with top %#04hhX..\n\n", s->p);
	for(uint16_t i = 0; i <= s->p; i++){ //0xFF; i++){
		printf("%#04hX : %#06hX\n", i, s->mem[i]);
	}
}

/*
// why is this so glitchy? Fine here two more functions that could be one to bloat the namespace
unsigned char uppernib(unsigned char c){
	return (c & 0xF0)>>4;
}

unsigned char lowernib(unsigned char c){
	return c & 0x0F;
}

FIXED*/


// BIGGEST BLOAT!!! An entire character set you may/may not be able to use!!
const unsigned char byteFont[128][8] = {
   {0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,},
   {0b00000000, 
    0b00011000, 
    0b00011000, 
    0b00011000, 
    0b00000000, 
    0b00011000, 
    0b00000000},
   {0b00000000,
    0b00000000,
    0b01101100,
    0b01101100,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,},
   {0b00000000,
    0b00101000,
    0b01111100,
    0b00101000,
    0b00101000,
    0b01111100,
    0b00101000,
    0b00000000,},
   {0b00010000,
    0b00111100,
    0b01010000,
    0b00111000,
    0b00010100,
    0b01111000,
    0b00010000,
    0b00000000},
   {0b00000000,
    0b01000010,
    0b10100100,
    0b01001000,
    0b00010100,
    0b00101010,
    0b01000100,
    0b00000000,},
   {0b00000000,
    0b00010000,
    0b00101000,
    0b00010000,
    0b00101010,
    0b01000100,
    0b00111010,
    0b00000000,},
   {0b00000000,
    0b00010000,
    0b00010000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,},
   {0b00000000,
    0b00011110,
    0b00100000,
    0b01000000,
    0b01000000,
    0b00100000,
    0b00011110,
    0b00000000,},
   {0b00000000,
    0b01111000,
    0b00000100,
    0b00000010,
    0b00000010,
    0b00000100,
    0b01111000,
    0b00000000,},
   {0b00000000,
    0b01010100,
    0b00111000,
    0b01111100,
    0b00111000,
    0b01010100,
    0b00000000,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b00010000,
    0b00010000,
    0b01111100,
    0b00010000,
    0b00010000,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00110000,
    0b00010000,},
   {0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b01111100,
    0b00000000,
    0b00000000,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00010000,
    0b00000000,},
   {0b00000000,
    0b00001000,
    0b00001000,
    0b00010000,
    0b00010000,
    0b00100000,
    0b00100000,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000010,
    0b01011010,
    0b01011010,
    0b01000010,
    0b00111100,
    0b00000000,},
   {0b00000000,
    0b00010000,
    0b00110000,
    0b00010000,
    0b00010000,
    0b00010000,
    0b01111100,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000010,
    0b00000100,
    0b00111000,
    0b01000000,
    0b01111110,
    0b00000000,},
   {0b00000000,
    0b01111100,
    0b00000010,
    0b00000100,
    0b00000010,
    0b00000010,
    0b01111100,
    0b00000000,},
   {0b00000000,
    0b00011000,
    0b00101000,
    0b01001000,
    0b01111100,
    0b00001000,
    0b00001000,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b01000000,
    0b01111100,
    0b00000010,
    0b00000010,
    0b01111100,
    0b00000000,},
   {0b00000000,
    0b00011110,
    0b00100000,
    0b00101100,
    0b00110010,
    0b00100010,
    0b00011110,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b00000010,
    0b00000100,
    0b00001000,
    0b00001000,
    0b00001000,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000010,
    0b00111100,
    0b01000010,
    0b01000010,
    0b00111100,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000010,
    0b00111110,
    0b00000010,
    0b00000100,
    0b01111000,
    0b00000000,}, 
    // :;<=>?@
   {0b00000000,
    0b00110000,
    0b00110000,
    0b00000000,
    0b00000000,
    0b00110000,
    0b00110000,
    0b00000000,},
   {0b00000000,
    0b00110000,
    0b00110000,
    0b00000000,
    0b00000000,
    0b00010000,
    0b00100000,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b00000100,
    0b00001000,
    0b00010000,
    0b00001000,
    0b00000100,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b00000000,
    0b01111110,
    0b00000000,
    0b01111110,
    0b00000000,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b01000000,
    0b00100000,
    0b00010000,
    0b00100000,
    0b01000000,
    0b00000000,},
   {0b00000000,
    0b00111000,
    0b01000100,
    0b00001000,
    0b00010000,
    0b00000000,
    0b00010000,
    0b00000000,},
   {0b00000000,
    0b00111000,
    0b01000100,
    0b10010010,
    0b10101010,
    0b10111010,
    0b01000100,
    0b00111100,},
    
    // ABCDEF
   {0b00000000,
    0b00011000,
    0b00100100,
    0b01000010,
    0b01111110,
    0b01000010,
    0b01000010,
    0b00000000,},
   {0b00000000,
    0b01111100,
    0b01000010,
    0b01111100,
    0b01000010,
    0b01000010,
    0b01111100,
    0b00000000,},
   {0b00000000,
    0b00011110,
    0b00100000,
    0b01000000,
    0b01000000,
    0b00100000,
    0b00011110,
    0b00000000,},
   {0b00000000,
    0b01110000,
    0b01001000,
    0b01000100,
    0b01000100,
    0b01001000,
    0b01110000,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b01000000,
    0b01111110,
    0b01000000,
    0b01000000,
    0b01111110,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b01000000,
    0b01111110,
    0b01000000,
    0b01000000,
    0b01000000,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000000,
    0b01000000,
    0b01001110,
    0b01000100,
    0b00111000,
    0b00000000,},
   {0b00000000,
    0b01000010,
    0b01000010,
    0b01111110,
    0b01000010,
    0b01000010,
    0b01000010,
    0b00000000,},
   {0b00000000,
    0b01111100,
    0b00010000,
    0b00010000,
    0b00010000,
    0b00010000,
    0b01111100,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b00000010,
    0b00000010,
    0b00000010,
    0b01000010,
    0b00111100,
    0b00000000,},
   {0b00000000,
    0b01001000,
    0b01010000,
    0b01100000,
    0b01010000,
    0b01001000,
    0b01000100,
    0b00000000,},
   {0b00000000,
    0b01000000,
    0b01000000,
    0b01000000,
    0b01000000,
    0b01000000,
    0b01111110,
    0b00000000,},
   {0b00000000,
    0b01000100,
    0b01101100,
    0b01010100,
    0b01000100,
    0b01000100,
    0b01000100,
    0b00000000,},
   {0b00000000,
    0b01000100,
    0b01100100,
    0b01010100,
    0b01010100,
    0b01001100,
    0b01000100,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000010,
    0b01000010,
    0b01000010,
    0b01000010,
    0b00111100,
    0b00000000,},
   {0b00000000,
    0b01111100,
    0b01000010,
    0b01000010,
    0b01111100,
    0b01000000,
    0b01000000,
    0b00000000,},
   {0b00000000,
    0b00111100,
    0b01000010,
    0b01000010,
    0b01001010,
    0b01000100,
    0b00111010,
    0b00000000,},
   {0b00000000,
    0b01111100,
    0b01000010,
    0b01111100,
    0b01001000,
    0b01000100,
    0b01000010,
    0b00000000,},
   {0b00000000,
    0b00111110,
    0b01000000,
    0b00111100,
    0b00000010,
    0b00000010,
    0b01111100,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b00010000,
    0b00010000,
    0b00010000,
    0b00010000,
    0b00010000,
    0b00000000,},
   {0b00000000,
    0b01000100,
    0b01000100,
    0b01000100,
    0b01000100,
    0b01000100,
    0b00111000,
    0b00000000,},
   {0b00000000,
    0b01000100,
    0b01000100,
    0b01000100,
    0b00101000,
    0b00101000,
    0b00010000,
    0b00000000,},
   {0b00000000,
    0b01000100,
    0b01000100,
    0b01000100,
    0b01010100,
    0b01010100,
    0b00101000,
    0b00000000,},
   {0b00000000,
    0b00000010,
    0b01000100,
    0b00101000,
    0b00010000,
    0b00101000,
    0b01000100,
    0b00000000,},
   {0b00000000,
    0b01000100,
    0b01000100,
    0b00101000,
    0b00010000,
    0b00010000,
    0b00010000,
    0b00000000,},
   {0b00000000,
    0b01111110,
    0b00000100,
    0b00001000,
    0b00010000,
    0b00100000,
    0b01111110,
    0b00000000,},
   {0b00000000,
    0b01111000,
    0b01000000,
    0b01000000,
    0b01000000,
    0b01000000,
    0b01111000,
    0b00000000,},
   {0b00000000,
    0b01000000,
    0b00100000,
    0b00010000,
    0b00001000,
    0b00000100,
    0b00000010,
    0b00000000,},
   {0b00000000,
    0b00010000,
    0b00101000,
    0b01000100,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,},
   {0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b01111110,
    0b00000000,},
   {0b00000000,
    0b01100000,
    0b00100000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,},
};

#endif